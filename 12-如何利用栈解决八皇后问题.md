# 追本溯源，什么是八皇后问题？

什么是八皇后问题？八皇后问题（Eight queens puzzle）起源于国际象棋，在国际象棋中，皇后的势力范围是它所在的行、列以及对角线，八皇后问题就是如何在一个 8×8 的棋盘上放置八个皇后，使得这八个皇后不能互相攻击（怎么听起来像是后宫戏啊）。换句话说就是，任何一个皇后都不会与其他皇后在同一行、同一列或者同一条对角线上。

八皇后问题是一个古老而又著名的问题，提出这个问题的并不是一个皇帝，而是由国际象棋棋手马克思·贝瑟尔于1848年提出。该问题一公布，立刻引起了数学家们的兴趣。1850年，弗朗兹·诺克公布了该问题的第一个解，并首次将八皇后问题扩展至 N 皇后问题，即在 N×N 的棋盘上放置 N 个皇后，使其不能相互攻击。

从那以后，包括高斯在内的许多数学家都研究过八皇后问题及其推广版本 N 皇后问题。1874年，S.冈德尔提出了一个通过行列式来求解的方法，这个方法后来又被J.W.L.格莱舍加以改进。1972年，Dijkstra 以这个问题为例说明来说明他提出的结构性编程的能力。他发表了一篇关于深度优先回溯算法的非常详细的描述。

![](https://github.com/YoungYo/Algorithm/blob/master/Images/8-%E6%A0%88/360px-Edsger_Wybe_Dijkstra.jpg?raw=true)

![](https://github.com/YoungYo/Algorithm/blob/master/Images/8-%E6%A0%88/2018-12-23_151200.png?raw=true)

而本文正是基于大神 Dijkstra 的回溯算法来向读者朋友们介绍 N 皇后问题的解法。

# 你的第一反应？

当你看完问题描述时，你的第一反应是什么？反正我首先想到的就是暴力求解法。所谓暴力求解，就是不管三七二十一，怼就完了。你不是在 8×8 的棋盘上放置八个皇后吗？行，那我就把所有的放置方案穷举出来，然后一一考查，把不符合要求的方案踢掉，那么剩下的不就是问题的解了吗？思路简单清晰，看似没毛病，很黄。。。咳咳，不对，很暴力。

但是仔细分析一下，我们就会发现，在 8×8 的棋盘上放置八个皇后，总共有 4, 426, 165, 368（也就是$C^{8}_{64}$）种放置方案。暂且不考虑如何验证每个方案的正确与否，单是遍历这 44 亿个方案，恐怕就要等很长时间。所以这种暴力求解法虽然逻辑上说得通，但是在实践中是没有可行性的。

可能有人会说了，何不改进一下？我们不需要八个皇后在棋盘上的所有排列组合，既然皇后之间不能相互攻击，那么每行只能放一个皇后，这样的话，候选方案的数量就减少至 16, 777, 216（即 $8^8$）。再进一步优化，不难发现，棋盘的每一列也只能放一个皇后，所以候选方案的数量又进一步减少至 40, 320（即 8!)。

现在看起来似乎经过优化的暴力求解有了一定的可行性，它变得和蔼可亲了，不再那么面目狰狞了。别着急，事情还没完。

# 主角登场

在前面优化后所得到的 40, 320 个候选方案中，依然存在大量的冗余。比如说，看下面这张图，蓝色方块表示已经放好的皇后，在我们放第 6 个皇后时，会发现无论放到哪里它都会被攻击。在这种情况下，后续第 7 个、第 8 个皇后的试探都必将是徒劳的。所以说，虽然我们已经将候选方案从 44 亿优化到了 4 万，但是这 4 万多个方案中仍然存在着类似下图的这种冗余。

![](//github.com/YoungYo/Algorithm/blob/master/Images/8-%E6%A0%88/2018-12-23_152655.png?raw=true)

故当我们发现第 k（1 <= k <= N） 个皇后摆放在任何位置都会造成冲突时，应该回溯到上一个皇后，而不是继续向下试探。这样就可以避免做很多无用功。